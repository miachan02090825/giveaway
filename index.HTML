<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ–·æ¨é›¢é¡§å• - ç†æ€§å¯¦è¸ç‰ˆ</title>
    <style>
        :root { --slate: #475569; --cool-gray: #f8fafc; --accent: #6366f1; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--cool-gray); color: #1e293b; padding: 20px; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; height: 95vh; }
        h1 { text-align: center; color: var(--slate); margin: 10px 0; font-weight: 600; font-size: 1.4rem; }
        .box { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        
        .preview-container { text-align: center; display: none; margin-top: 10px; }
        #previewImage { max-width: 100%; max-height: 200px; border-radius: 6px; }
        
        #chat { flex-grow: 1; overflow-y: auto; background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 12px; }
        .msg { padding: 12px 16px; border-radius: 12px; line-height: 1.6; max-width: 85%; font-size: 15px; white-space: pre-wrap; }
        .coach { background: #f1f5f9; color: #334155; align-self: flex-start; border-left: 4px solid var(--accent); }
        .user { background: var(--accent); color: white; align-self: flex-end; }
        
        .upload-btn { background: #fff; border: 2px dashed #cbd5e1; color: var(--slate); padding: 15px; text-align: center; cursor: pointer; border-radius: 12px; transition: 0.2s; }
        .upload-btn:hover { border-color: var(--accent); color: var(--accent); }
        
        .input-group { display: flex; gap: 10px; background: #fff; padding: 10px; border-radius: 15px; border: 1px solid #e2e8f0; }
        textarea#userInput { 
            flex: 1; padding: 8px; border: none; outline: none; background: transparent; 
            resize: none; font-family: inherit; font-size: 15px; height: 24px; max-height: 100px;
        }
        button#sendBtn { align-self: flex-end; padding: 8px 20px; background: var(--accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        button:disabled { background: #cbd5e1; cursor: not-allowed; }
        #status { font-size: 12px; color: #94a3b8; text-align: center; height: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“Š æ–·æ¨é›¢ç”Ÿæ´»é¡§å•</h1>
    
    <div class="box">
        <input type="password" id="apiKey" style="width: 100%; box-sizing: border-box; border: none; outline: none;" placeholder="è¼¸å…¥ API Key é–‹å§‹åˆ†æ">
    </div>

    <div class="box upload-btn" onclick="document.getElementById('fileInput').click()">
        ğŸ” æäº¤ç‰©å“å½±åƒé€²è¡Œç†æ€§è©•ä¼°
        <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFile(event)">
        <div class="preview-container" id="previewContainer">
            <img id="previewImage" src="" alt="è©•ä¼°å°è±¡">
        </div>
    </div>

    <div id="chat">
        <div class="msg coach">ä½ å¥½ã€‚æˆ‘æ˜¯ä½ çš„ç©ºé–“ç®¡ç†é¡§å•ã€‚è«‹ä¸Šå‚³ç‰©å“ï¼Œæˆ‘å°‡å¾å¯¦ç”¨æ€§ã€ç©ºé–“ä½”æ¯”èˆ‡ä½¿ç”¨é »ç‡ç‚ºä½ æä¾›ç²¾ç¢ºå»ºè­°ã€‚</div>
    </div>

    <div id="status"></div>

    <div class="input-group">
        <textarea id="userInput" placeholder="è«‹å›ç­”æå•... (Shift+Enter æ›è¡Œ)" disabled rows="1"></textarea>
        <button id="sendBtn" onclick="sendReply()" disabled>åˆ†æ</button>
    </div>
</div>

<script>
    let currentHistory = [], imgB64 = "", imgMime = "";
    
    // ä¸­æ€§ã€ç†æ€§ä¸”çŠ€åˆ©çš„äººè¨­
    const COACH_PROMPT = "ä½ æ˜¯ä¸€ä½ç†æ™ºã€å†·éœä¸”çŠ€åˆ©çš„ç©ºé–“ç®¡ç†é¡§å•ã€‚ä½ èªªè©±ä¸å¸¶éå¤šæƒ…ç·’ï¼Œä½†é‚è¼¯æ¥µå¼·ã€‚ä»»å‹™ï¼š1. è¾¨è­˜ç‰©å“ä¸¦æŒ‡å‡ºå…¶æŠ˜èˆŠç¨‹åº¦ã€‚2. æå‡º3å€‹é—œæ–¼ã€Œç©ºé–“æ•ˆç‡ã€èˆ‡ã€ŒçœŸå¯¦ä½¿ç”¨ç‡ã€çš„æ•¸æ“šåŒ–æå•ã€‚3. æ ¹æ“šå›ç­”çµ¦äºˆã€ç•™å­˜ã€‘æˆ–ã€ç§»é™¤ã€‘çš„å°ˆæ¥­åˆ¤æ±ºï¼Œä¸¦é™„ä¸Šç©ºé–“å„ªåŒ–å»ºè­°ã€‚";

    function handleFile(e) {
        const file = e.target.files[0];
        if (!file) return;
        imgMime = file.type;
        const reader = new FileReader();
        reader.onload = (ev) => {
            document.getElementById('previewImage').src = ev.target.result;
            document.getElementById('previewContainer').style.display = 'block';
            imgB64 = ev.target.result.split(',')[1];
            addMsg('user', 'ï¼ˆæäº¤ç‰©å“å½±åƒï¼Œè«‹æ±‚æ•ˆç‡åˆ†æï¼‰');
            callAI(true);
        };
        reader.readAsDataURL(file);
    }

    function addMsg(role, text) {
        const c = document.getElementById('chat');
        const d = document.createElement('div');
        d.className = `msg ${role}`;
        d.innerText = text;
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;
    }

    async function callAI(isFirst, text = "") {
        const key = document.getElementById('apiKey').value.trim();
        if (!key) return alert("è«‹è¼¸å…¥ API Key");
        document.getElementById('status').innerText = "æ­£åœ¨é€²è¡Œé‚è¼¯é‹ç®—...";
        
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;

        if (isFirst) {
            currentHistory = [{ role: "user", parts: [{ text: "æŒ‡ä»¤ï¼š" + COACH_PROMPT }, { inlineData: { mimeType: imgMime, data: imgB64 } }] }];
        } else {
            currentHistory.push({ role: "user", parts: [{ text: text }] });
        }

        try {
            const r = await fetch(url, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: currentHistory }) });
            const d = await r.json();
            const reply = d.candidates[0].content.parts[0].text;
            addMsg('coach', reply);
            currentHistory.push({ role: 'model', parts: [{ text: reply }] });
            document.getElementById('userInput').disabled = false;
            document.getElementById('sendBtn').disabled = false;
            document.getElementById('userInput').focus();
        } catch (err) { addMsg('coach', "é€£ç·šéŒ¯èª¤ï¼š" + err.message); }
        finally { document.getElementById('status').innerText = ""; }
    }

    function sendReply() {
        const i = document.getElementById('userInput');
        const t = i.value.trim();
        if (!t) return;
        addMsg('user', t);
        i.value = ""; i.disabled = true;
        i.style.height = '24px';
        callAI(false, t);
    }

    const inputArea = document.getElementById('userInput');
    inputArea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendReply();
        }
    });

    inputArea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
</script>

</body>
</html>